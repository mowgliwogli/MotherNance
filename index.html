<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mother Nance - Sourdough Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #D4854A; --primary-dark: #B86B32; --primary-light: #F5DCC8; --bg: #FDF8F3; --bg-card: #FFFFFF; --text: #2D2418; --text-secondary: #7A6F61; --success: #5D8C4A; --warning: #D4A94A; --danger: #C45D4A; --border: #E8DFD4; --shadow: 0 2px 12px rgba(45, 36, 24, 0.08); --radius: 16px; --radius-sm: 10px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .app-container { max-width: 430px; margin: 0 auto; min-height: 100vh; background: var(--bg); padding-bottom: 90px; }
        .header { padding: 20px 24px 16px; background: var(--bg); position: sticky; top: 0; z-index: 100; }
        .header h1 { font-family: 'Fraunces', serif; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .header h1 .logo { width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .tab-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: var(--bg-card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 8px 12px 24px; z-index: 1000; }
        .tab-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 12px; border: none; background: none; color: var(--text-secondary); cursor: pointer; }
        .tab-btn.active { color: var(--primary); }
        .tab-btn svg { width: 24px; height: 24px; }
        .tab-btn span { font-size: 11px; font-weight: 600; }
        .content { padding: 0 20px 20px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 16px; margin-bottom: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); cursor: pointer; }
        .starter-card, .session-card { display: flex; align-items: center; gap: 14px; }
        .starter-status { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
        .starter-status.good { background: var(--success); }
        .starter-status.warning { background: var(--warning); }
        .starter-status.danger { background: var(--danger); }
        .starter-icon, .session-phase { width: 44px; height: 44px; background: var(--primary-light); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .starter-info, .session-info, .recipe-info { flex: 1; }
        .starter-name, .session-name, .recipe-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; color: var(--text); }
        .starter-meta, .session-meta { font-size: 13px; color: var(--text-secondary); display: flex; gap: 8px; flex-wrap: wrap; }
        .phase-time { color: var(--primary); font-weight: 500; }
        .fed-btn { padding: 8px 16px; background: rgba(93, 140, 74, 0.12); color: var(--success); border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; gap: 8px; }
        .section-title { font-family: 'Fraunces', serif; font-size: 20px; font-weight: 600; }
        .header-buttons { display: flex; gap: 8px; }
        .add-btn { width: 36px; height: 36px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .icon-btn { width: 36px; height: 36px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: 10px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .recipe-card { display: flex; gap: 14px; }
        .recipe-thumb { width: 70px; height: 70px; background: linear-gradient(135deg, var(--primary-light), #E8D4C4); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
        .tag { padding: 4px 10px; background: var(--bg); border-radius: 6px; font-size: 12px; color: var(--text-secondary); display: inline-block; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: flex-end; justify-content: center; z-index: 2000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: var(--bg-card); border-radius: 24px 24px 0 0; width: 100%; max-width: 430px; max-height: 90vh; overflow-y: auto; transform: translateY(100%); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: var(--bg-card); z-index: 10; }
        .modal-title { font-family: 'Fraunces', serif; font-size: 20px; font-weight: 600; }
        .modal-close { width: 32px; height: 32px; background: var(--bg); border: none; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .modal-body { padding: 20px 24px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text); }
        .form-input, .form-select { width: 100%; padding: 14px 16px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 16px; font-family: inherit; background: var(--bg); color: var(--text); }
        textarea.form-input { min-height: 80px; resize: vertical; }
        .btn-primary { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: var(--radius-sm); font-size: 16px; font-weight: 600; cursor: pointer; margin-bottom: 10px; }
        .btn-secondary { width: 100%; padding: 12px 16px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 10px; }
        .btn-danger { width: 100%; padding: 16px; background: rgba(196, 93, 74, 0.1); color: var(--danger); border: none; border-radius: var(--radius-sm); font-size: 16px; font-weight: 600; cursor: pointer; }
        .toggle-group { display: flex; background: var(--bg); border-radius: var(--radius-sm); padding: 4px; }
        .toggle-option { flex: 1; padding: 12px; border: none; background: none; font-size: 14px; font-weight: 500; cursor: pointer; border-radius: 8px; color: var(--text-secondary); }
        .toggle-option.active { background: var(--bg-card); color: var(--text); box-shadow: var(--shadow); }
        .detail-section { background: var(--bg); border-radius: var(--radius-sm); padding: 16px; margin-bottom: 16px; }
        .detail-section h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--text); }
        .check-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; cursor: pointer; border-bottom: 1px solid var(--border); }
        .check-item:last-child { border-bottom: none; }
        .check-item.checked .check-text { text-decoration: line-through; color: var(--text-secondary); }
        .check-icon { font-size: 20px; flex-shrink: 0; }
        .check-text { flex: 1; line-height: 1.4; color: var(--text); }
        .timer-badge { display: inline-flex; align-items: center; gap: 6px; padding: 10px 14px; background: rgba(212,133,74,0.1); border-radius: 8px; font-size: 14px; color: var(--primary); margin-bottom: 16px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-nav button { width: 36px; height: 36px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; font-size: 18px; }
        .calendar-month { font-family: 'Fraunces', serif; font-size: 20px; font-weight: 600; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day-header { text-align: center; font-size: 12px; font-weight: 600; color: var(--text-secondary); padding: 8px 0; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 10px; cursor: pointer; font-size: 14px; gap: 2px; color: var(--text); }
        .calendar-day:hover { background: var(--bg-card); }
        .calendar-day.today { border: 2px solid var(--primary); }
        .calendar-day.selected { background: rgba(212, 133, 74, 0.15); }
        .calendar-dots { display: flex; gap: 3px; }
        .calendar-dot { width: 5px; height: 5px; border-radius: 50%; }
        .calendar-dot.feeding { background: var(--warning); }
        .calendar-dot.session { background: var(--primary); }
        .event-card { padding: 12px; background: var(--bg); border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .event-card:hover { background: var(--border); }
        .empty-state { text-align: center; padding: 40px 20px; }
        .empty-state-icon { width: 80px; height: 80px; background: var(--primary-light); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 36px; margin: 0 auto 20px; }
        .json-input { font-family: monospace; font-size: 12px; min-height: 150px; }
        .template-box { background: var(--bg); padding: 12px; border-radius: 8px; font-family: monospace; font-size: 11px; white-space: pre-wrap; margin-bottom: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header"><h1><span class="logo">üçû</span>Mother Nance</h1></header>
        <main class="content">
            <div id="starters-tab" class="tab-content active">
                <div class="section-header"><h2 class="section-title">Starters</h2><button class="add-btn" onclick="openModal('add-starter')">+</button></div>
                <div id="starters-list"></div>
            </div>
            <div id="recipes-tab" class="tab-content">
                <div class="section-header">
                    <h2 class="section-title">Recipes</h2>
                    <div class="header-buttons">
                        <button class="icon-btn" onclick="exportAllRecipes()" title="Export All">‚Üë</button>
                        <button class="icon-btn" onclick="openModal('import-recipe')" title="Import">‚Üì</button>
                        <button class="add-btn" onclick="openModal('add-recipe')">+</button>
                    </div>
                </div>
                <div id="recipes-list"></div>
            </div>
            <div id="sessions-tab" class="tab-content">
                <div class="section-header"><h2 class="section-title">Sessions</h2><button class="add-btn" onclick="openModal('start-session')">+</button></div>
                <div id="sessions-list"></div>
            </div>
            <div id="calendar-tab" class="tab-content">
                <div class="calendar-header"><div class="calendar-nav"><button onclick="changeMonth(-1)">&lt;</button></div><span class="calendar-month" id="calendar-month"></span><div class="calendar-nav"><button onclick="changeMonth(1)">&gt;</button></div></div>
                <div class="calendar-grid" id="calendar-grid"></div>
                <div id="calendar-events" style="margin-top: 20px;"></div>
            </div>
        </main>
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('starters')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg><span>Starters</span></button>
            <button class="tab-btn" onclick="switchTab('recipes')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg><span>Recipes</span></button>
            <button class="tab-btn" onclick="switchTab('sessions')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>Sessions</span></button>
            <button class="tab-btn" onclick="switchTab('calendar')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span>Calendar</span></button>
        </nav>
    </div>

    <!-- Add Starter Modal -->
    <div class="modal-overlay" id="add-starter-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="starter-modal-title">Add Starter</h3><button class="modal-close" onclick="closeModal('add-starter')">&times;</button></div><div class="modal-body">
        <input type="hidden" id="edit-starter-id">
        <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" id="starter-name" placeholder="e.g., Nancy"></div>
        <div class="form-group"><label class="form-label">Location</label><div class="toggle-group"><button class="toggle-option active" data-value="refrigerator" onclick="selectLocation(this)">Fridge</button><button class="toggle-option" data-value="countertop" onclick="selectLocation(this)">Countertop</button><button class="toggle-option" data-value="dried" onclick="selectLocation(this)">Dried</button></div></div>
        <div class="form-group" id="fed-date-group"><label class="form-label">Last Fed Date</label><input type="date" class="form-input" id="starter-last-fed"></div>
        <div class="form-group"><label class="form-label">Notes</label><textarea class="form-input" id="starter-notes"></textarea></div>
        <button class="btn-primary" onclick="saveStarter()">Save Starter</button>
        <button class="btn-danger" id="delete-starter-btn" style="display:none" onclick="deleteStarter()">Delete Starter</button>
    </div></div></div>

    <!-- Add Recipe Modal -->
    <div class="modal-overlay" id="add-recipe-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="recipe-modal-title">Add Recipe</h3><button class="modal-close" onclick="closeModal('add-recipe')">&times;</button></div><div class="modal-body">
        <input type="hidden" id="edit-recipe-id">
        <div class="form-group"><label class="form-label">Recipe Name</label><input type="text" class="form-input" id="recipe-name"></div>
        <div class="form-group"><label class="form-label">Bread Type</label><input type="text" class="form-input" id="recipe-type" placeholder="e.g., Sourdough"></div>
        <div class="form-group"><label class="form-label">Number of Days</label><select class="form-select" id="recipe-days"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="form-group"><label class="form-label">Ingredients</label><div id="ingredients-list" style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:8px;min-height:50px"></div><button type="button" class="btn-secondary" onclick="addIngredient()">+ Add Ingredient</button></div>
        <div class="form-group"><label class="form-label">Directions</label><div id="directions-list" style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:8px;min-height:50px"></div><button type="button" class="btn-secondary" onclick="addDirection()">+ Add Step</button></div>
        <div class="form-group"><label class="form-label">Notes</label><textarea class="form-input" id="recipe-notes"></textarea></div>
        <button class="btn-primary" onclick="saveRecipe()">Save Recipe</button>
        <button class="btn-danger" id="delete-recipe-btn" style="display:none" onclick="deleteRecipe()">Delete Recipe</button>
    </div></div></div>

    <!-- Import Recipe Modal -->
    <div class="modal-overlay" id="import-recipe-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Import Recipe</h3><button class="modal-close" onclick="closeModal('import-recipe')">&times;</button></div><div class="modal-body">
        <div class="form-group">
            <label class="form-label">Paste Recipe JSON</label>
            <textarea class="form-input json-input" id="import-json" placeholder="Paste your recipe JSON here..."></textarea>
        </div>
        <button class="btn-secondary" onclick="pasteFromClipboard()">üìã Paste from Clipboard</button>
        <button class="btn-primary" onclick="importRecipes()">Import Recipe</button>
        <div class="form-group" style="margin-top:20px">
            <label class="form-label">Template Format</label>
            <div class="template-box">{
  "name": "Recipe Name",
  "type": "Sourdough",
  "days": 2,
  "ingredients": [
    {"amount": "500", "unit": "g", "name": "Flour"}
  ],
  "directions": [
    {"day": 1, "step": "Mix ingredients"}
  ],
  "notes": "Optional notes"
}</div>
            <button class="btn-secondary" onclick="copyTemplate()">üìÑ Copy Template</button>
        </div>
    </div></div></div>

    <!-- View Recipe Modal -->
    <div class="modal-overlay" id="view-recipe-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="view-recipe-title">Recipe</h3><button class="modal-close" onclick="closeModal('view-recipe')">&times;</button></div><div class="modal-body" id="view-recipe-body"></div></div></div>
    
    <!-- Start Session Modal -->
    <div class="modal-overlay" id="start-session-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Start Session</h3><button class="modal-close" onclick="closeModal('start-session')">&times;</button></div><div class="modal-body">
        <div class="form-group"><label class="form-label">Select Recipe</label><select class="form-select" id="session-recipe"></select></div>
        <div class="form-group"><label class="form-label">Select Starter (Optional)</label><select class="form-select" id="session-starter"><option value="">None</option></select></div>
        <button class="btn-primary" onclick="startSession()">Start Baking</button>
    </div></div></div>
    
    <!-- Session Detail Modal -->
    <div class="modal-overlay" id="session-detail-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="session-detail-title">Session</h3><button class="modal-close" onclick="closeModal('session-detail')">&times;</button></div><div class="modal-body" id="session-detail-body"></div></div></div>
    
    <!-- Starter Detail Modal -->
    <div class="modal-overlay" id="starter-detail-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="starter-detail-title">Starter</h3><button class="modal-close" onclick="closeModal('starter-detail')">&times;</button></div><div class="modal-body" id="starter-detail-body"></div></div></div>

    <script>
        var appData = { starters: [], recipes: [], sessions: [] };
        var currentMonth = new Date();
        var selectedDate = new Date();
        var selectedLocation = 'refrigerator';
        var tempIngredients = [];
        var tempDirections = [];

        var defaultNotesTemplate = "‚îÄ‚îÄ DAY NOTES ‚îÄ‚îÄ\n\n\n‚îÄ‚îÄ MIXING ‚îÄ‚îÄ\nStarter characteristics: \nRoom temperature: \nWater temperature: \nDough temp at end of mixing: \nDough characteristics: \n\n‚îÄ‚îÄ FERMENTATION ‚îÄ‚îÄ\nStart time: \nRoom/fridge temp: \nDough temp at end: \nEnd time: \nDough characteristics: \n\n‚îÄ‚îÄ SHAPING ‚îÄ‚îÄ\nTime shaped: \nDough characteristics: \n\n‚îÄ‚îÄ PROOFING ‚îÄ‚îÄ\nStart time: \nRoom/fridge temp: \nDough temp at end: \nEnd time: \nDough characteristics: \n\n‚îÄ‚îÄ BAKING ‚îÄ‚îÄ\nOven temperature: \nBaking time: \n\n‚îÄ‚îÄ AFTER-BAKE ‚îÄ‚îÄ\nCrust color: \nShape: \nVolume: \nAroma: \nInterior hole structure: \nTaste: \n\n‚îÄ‚îÄ COMMENTS ‚îÄ‚îÄ\n";

        function loadData() {
            var saved = localStorage.getItem('mothernance_data');
            if (saved) appData = JSON.parse(saved);
            if (!appData.starters.length) appData.starters = [{ id: 1, name: 'Nancy', location: 'refrigerator', lastFed: new Date(Date.now() - 5*86400000).toISOString().split('T')[0], notes: 'Main starter' }];
            if (!appData.recipes.length) appData.recipes = [{ id: 1, name: 'Country Loaf', type: 'Sourdough', days: 2, ingredients: [{id:1,amount:'500',unit:'g',name:'Bread Flour'},{id:2,amount:'350',unit:'g',name:'Water'},{id:3,amount:'100',unit:'g',name:'Starter'},{id:4,amount:'10',unit:'g',name:'Salt'}], directions: [{id:1,day:1,step:'Mix flour and water, autolyse 30 min'},{id:2,day:1,step:'Add starter and salt, mix well'},{id:3,day:1,step:'Bulk ferment 4-6 hours with folds'},{id:4,day:2,step:'Preheat oven to 500F'},{id:5,day:2,step:'Bake covered 20 min, uncovered 25 min'}], phases: ['mixing','bulk-fermentation','shaping','proofing','baking','completed'] }];
            saveData();
        }
        function saveData() { localStorage.setItem('mothernance_data', JSON.stringify(appData)); }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(function(e) { e.classList.remove('active'); });
            document.querySelectorAll('.tab-btn').forEach(function(e) { e.classList.remove('active'); });
            document.getElementById(t + '-tab').classList.add('active');
            document.querySelectorAll('.tab-btn')[['starters','recipes','sessions','calendar'].indexOf(t)].classList.add('active');
            if (t === 'calendar') renderCalendar();
        }

        function renderStarters() {
            var c = document.getElementById('starters-list');
            if (!appData.starters.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ü´ô</div><h3>No Starters</h3><p style="color:var(--text-secondary)">Add your first starter</p></div>'; return; }
            c.innerHTML = appData.starters.map(function(s) {
                var days = s.lastFed ? Math.floor((Date.now() - new Date(s.lastFed+'T00:00:00').getTime()) / 86400000) : null;
                var threshold = s.location === 'refrigerator' ? 7 : 1;
                var status = s.location === 'dried' ? 'good' : days === null ? 'warning' : days < threshold ? 'good' : days === threshold ? 'warning' : 'danger';
                var fedStr = s.lastFed ? new Date(s.lastFed+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'}) : 'Never';
                var locName = s.location.charAt(0).toUpperCase() + s.location.slice(1);
                return '<div class="card starter-card" onclick="editStarter('+s.id+')"><div class="starter-status '+status+'"></div><div class="starter-icon">ü´ô</div><div class="starter-info"><div class="starter-name">'+s.name+'</div><div class="starter-meta"><span>'+locName+'</span><span>Fed: '+fedStr+'</span>'+(days!==null?' <span>('+days+'d)</span>':'')+'</div></div>'+(s.location!=='dried'?'<button class="fed-btn" onclick="event.stopPropagation();feedStarter('+s.id+')">Fed</button>':'')+'</div>';
            }).join('');
        }

        function renderRecipes() {
            var c = document.getElementById('recipes-list');
            if (!appData.recipes.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìñ</div><h3>No Recipes</h3><p style="color:var(--text-secondary)">Add your first recipe</p></div>'; return; }
            c.innerHTML = appData.recipes.map(function(r) { return '<div class="card recipe-card" onclick="viewRecipe('+r.id+')"><div class="recipe-thumb">üçû</div><div class="recipe-info"><div class="recipe-name">'+r.name+'</div><div style="font-size:13px;color:var(--text-secondary)">'+(r.type||'Bread')+'</div><div style="margin-top:6px"><span class="tag">'+r.days+' day'+(r.days>1?'s':'')+'</span></div></div></div>'; }).join('');
        }

        function renderSessions() {
            var c = document.getElementById('sessions-list');
            if (!appData.sessions.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è±Ô∏è</div><h3>No Sessions</h3><p style="color:var(--text-secondary)">Start a baking session</p></div>'; return; }
            var active = appData.sessions.filter(function(s) { return s.isActive; });
            var completed = appData.sessions.filter(function(s) { return !s.isActive; });
            var html = '';
            if (active.length) {
                html += '<h4 style="color:var(--text-secondary);font-size:13px;margin-bottom:12px">ACTIVE</h4>';
                active.forEach(function(s) {
                    var phaseTime = getPhaseTime(s);
                    html += '<div class="card session-card" onclick="openSessionDetail('+s.id+')"><div class="session-phase">'+getPhaseIcon(s.currentPhase)+'</div><div class="session-info"><div class="session-name">'+s.recipeName+'</div><div class="session-meta">'+(s.starterName?'<span>'+s.starterName+'</span>':'')+'<span>Day '+s.currentDay+'</span><span>'+s.currentPhase+'</span><span class="phase-time">'+phaseTime+'</span></div></div></div>';
                });
            }
            if (completed.length) {
                html += '<h4 style="color:var(--text-secondary);font-size:13px;margin:20px 0 12px">COMPLETED</h4>';
                completed.slice(0,5).forEach(function(s) { html += '<div class="card session-card" onclick="openSessionDetail('+s.id+')"><div class="session-phase" style="background:rgba(93,140,74,0.12)">‚úì</div><div class="session-info"><div class="session-name">'+s.recipeName+'</div></div></div>'; });
            }
            c.innerHTML = html;
        }

        function getPhaseTime(s) {
            if (!s.phaseStartTime) return '0m';
            var mins = Math.floor((Date.now() - new Date(s.phaseStartTime).getTime()) / 60000);
            return mins >= 60 ? Math.floor(mins/60)+'h '+mins%60+'m' : mins+'m';
        }
        function getPhaseIcon(p) { return {mixing:'ü•Ñ','bulk-fermentation':'ü´ó',shaping:'ü§≤',proofing:'üß∫',baking:'üî•',completed:'‚úì'}[p]||'?'; }

        function openModal(t) {
            if (t === 'add-starter') { document.getElementById('starter-modal-title').textContent = 'Add Starter'; document.getElementById('edit-starter-id').value = ''; document.getElementById('starter-name').value = ''; document.getElementById('starter-last-fed').value = ''; document.getElementById('starter-notes').value = ''; document.getElementById('delete-starter-btn').style.display = 'none'; selectedLocation = 'refrigerator'; document.querySelectorAll('#add-starter-modal .toggle-option').forEach(function(b){b.classList.remove('active');}); document.querySelector('#add-starter-modal .toggle-option[data-value="refrigerator"]').classList.add('active'); document.getElementById('fed-date-group').style.display = 'block'; }
            if (t === 'add-recipe') { document.getElementById('recipe-modal-title').textContent = 'Add Recipe'; document.getElementById('edit-recipe-id').value = ''; document.getElementById('recipe-name').value = ''; document.getElementById('recipe-type').value = ''; document.getElementById('recipe-notes').value = ''; document.getElementById('delete-recipe-btn').style.display = 'none'; tempIngredients = []; tempDirections = []; renderTempIngredients(); renderTempDirections(); }
            if (t === 'start-session') { document.getElementById('session-recipe').innerHTML = appData.recipes.map(function(r){return '<option value="'+r.id+'">'+r.name+'</option>';}).join(''); document.getElementById('session-starter').innerHTML = '<option value="">None</option>' + appData.starters.filter(function(s){return s.location!=='dried';}).map(function(s){return '<option value="'+s.id+'">'+s.name+'</option>';}).join(''); }
            if (t === 'import-recipe') { document.getElementById('import-json').value = ''; }
            document.getElementById(t + '-modal').classList.add('active');
        }
        function closeModal(t) { document.getElementById(t + '-modal').classList.remove('active'); }
        function selectLocation(btn) { document.querySelectorAll('#add-starter-modal .toggle-option').forEach(function(b){b.classList.remove('active');}); btn.classList.add('active'); selectedLocation = btn.dataset.value; document.getElementById('fed-date-group').style.display = selectedLocation === 'dried' ? 'none' : 'block'; }

        function saveStarter() {
            var name = document.getElementById('starter-name').value.trim(); if (!name) return alert('Enter name');
            var editId = document.getElementById('edit-starter-id').value;
            var data = { id: editId ? parseInt(editId) : Date.now(), name: name, location: selectedLocation, lastFed: document.getElementById('starter-last-fed').value || null, notes: document.getElementById('starter-notes').value };
            if (editId) { var i = appData.starters.findIndex(function(s){return s.id===parseInt(editId);}); if (i !== -1) appData.starters[i] = data; }
            else { if (appData.starters.length >= 10) return alert('Max 10'); appData.starters.push(data); }
            saveData(); renderStarters(); closeModal('add-starter');
        }
        function editStarter(id) {
            var s = appData.starters.find(function(x){return x.id===id;}); if (!s) return;
            document.getElementById('starter-modal-title').textContent = 'Edit Starter';
            document.getElementById('edit-starter-id').value = s.id;
            document.getElementById('starter-name').value = s.name;
            document.getElementById('starter-last-fed').value = s.lastFed || '';
            document.getElementById('starter-notes').value = s.notes || '';
            document.getElementById('delete-starter-btn').style.display = 'block';
            selectedLocation = s.location;
            document.querySelectorAll('#add-starter-modal .toggle-option').forEach(function(b){b.classList.remove('active');});
            var locBtn = document.querySelector('#add-starter-modal .toggle-option[data-value="'+s.location+'"]');
            if (locBtn) locBtn.classList.add('active');
            document.getElementById('fed-date-group').style.display = s.location === 'dried' ? 'none' : 'block';
            document.getElementById('add-starter-modal').classList.add('active');
        }
        function deleteStarter() { if (!confirm('Delete this starter?')) return; appData.starters = appData.starters.filter(function(s){return s.id!==parseInt(document.getElementById('edit-starter-id').value);}); saveData(); renderStarters(); closeModal('add-starter'); }
        function feedStarter(id) { var s = appData.starters.find(function(x){return x.id===id;}); if (s) { s.lastFed = new Date().toISOString().split('T')[0]; saveData(); renderStarters(); } }

        function renderTempIngredients() { var c = document.getElementById('ingredients-list'); c.innerHTML = tempIngredients.length ? tempIngredients.map(function(i,idx){return '<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)"><span style="flex:1;color:var(--text)"><b>'+i.amount+' '+i.unit+'</b> '+i.name+'</span><button onclick="tempIngredients.splice('+idx+',1);renderTempIngredients()" style="background:rgba(196,93,74,0.1);color:var(--danger);border:none;border-radius:6px;width:28px;height:28px;cursor:pointer">√ó</button></div>';}).join('') : '<p style="color:var(--text-secondary);text-align:center">No ingredients</p>'; }
        function addIngredient() { var a = prompt('Amount (e.g., 500):'); if (!a) return; var u = prompt('Unit (e.g., g):') || 'g'; var n = prompt('Ingredient name:'); if (!n) return; tempIngredients.push({id:Date.now(),amount:a,unit:u,name:n}); renderTempIngredients(); }
        function renderTempDirections() { var c = document.getElementById('directions-list'); c.innerHTML = tempDirections.length ? tempDirections.map(function(d,idx){return '<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)"><span style="width:24px;height:24px;background:var(--primary);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px">'+(idx+1)+'</span><span style="flex:1;color:var(--text)"><b>Day '+d.day+':</b> '+d.step+'</span><button onclick="tempDirections.splice('+idx+',1);renderTempDirections()" style="background:rgba(196,93,74,0.1);color:var(--danger);border:none;border-radius:6px;width:28px;height:28px;cursor:pointer">√ó</button></div>';}).join('') : '<p style="color:var(--text-secondary);text-align:center">No directions</p>'; }
        function addDirection() { var day = prompt('Which day? (1-5):') || '1'; var step = prompt('Direction:'); if (!step) return; tempDirections.push({id:Date.now(),day:parseInt(day),step:step}); renderTempDirections(); }

        function saveRecipe() {
            var name = document.getElementById('recipe-name').value.trim(); if (!name) return alert('Enter name');
            var editId = document.getElementById('edit-recipe-id').value;
            var data = { id: editId ? parseInt(editId) : Date.now(), name: name, type: document.getElementById('recipe-type').value || 'Bread', days: parseInt(document.getElementById('recipe-days').value), notes: document.getElementById('recipe-notes').value, ingredients: tempIngredients.slice(), directions: tempDirections.slice(), phases: ['mixing','bulk-fermentation','shaping','proofing','baking','completed'] };
            if (editId) { var i = appData.recipes.findIndex(function(r){return r.id===parseInt(editId);}); if (i !== -1) appData.recipes[i] = data; }
            else appData.recipes.push(data);
            saveData(); renderRecipes(); closeModal('add-recipe');
        }
        function viewRecipe(id) {
            var r = appData.recipes.find(function(x){return x.id===id;}); if (!r) return;
            document.getElementById('view-recipe-title').textContent = r.name;
            var ingHtml = r.ingredients && r.ingredients.length ? r.ingredients.map(function(i){return '<div style="padding:6px 0;color:var(--text)">‚Ä¢ <b>'+i.amount+' '+i.unit+'</b> '+i.name+'</div>';}).join('') : '<p style="color:var(--text-secondary)">No ingredients</p>';
            var dirHtml = r.directions && r.directions.length ? r.directions.map(function(d,i){return '<div style="display:flex;gap:10px;padding:8px 0"><span style="width:24px;height:24px;background:var(--primary);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px">'+(i+1)+'</span><span style="color:var(--text)"><b>Day '+d.day+':</b> '+d.step+'</span></div>';}).join('') : '<p style="color:var(--text-secondary)">No directions</p>';
            document.getElementById('view-recipe-body').innerHTML = '<div class="detail-section"><h4>Ingredients</h4>'+ingHtml+'</div><div class="detail-section"><h4>Directions</h4>'+dirHtml+'</div>'+(r.notes?'<div class="detail-section"><h4>Notes</h4><p style="color:var(--text)">'+r.notes+'</p></div>':'')+'<div class="detail-section"><h4>Export</h4><button class="btn-secondary" onclick="exportRecipeJSON('+r.id+')">üì§ Export as JSON</button></div><button class="btn-primary" onclick="closeModal(\'view-recipe\');editRecipe('+r.id+')">Edit</button><button class="btn-primary" style="background:var(--success)" onclick="closeModal(\'view-recipe\');openModal(\'start-session\');document.getElementById(\'session-recipe\').value='+r.id+'">Start Session</button><button class="btn-danger" onclick="deleteRecipeConfirm('+r.id+')">Delete</button>';
            openModal('view-recipe');
        }
        function deleteRecipeConfirm(id) { if(confirm('Delete this recipe?')){appData.recipes=appData.recipes.filter(function(x){return x.id!==id;});saveData();renderRecipes();closeModal('view-recipe');} }
        function editRecipe(id) {
            var r = appData.recipes.find(function(x){return x.id===id;}); if (!r) return;
            document.getElementById('recipe-modal-title').textContent = 'Edit Recipe';
            document.getElementById('edit-recipe-id').value = r.id;
            document.getElementById('recipe-name').value = r.name;
            document.getElementById('recipe-type').value = r.type || '';
            document.getElementById('recipe-days').value = r.days;
            document.getElementById('recipe-notes').value = r.notes || '';
            document.getElementById('delete-recipe-btn').style.display = 'block';
            tempIngredients = r.ingredients ? r.ingredients.slice() : [];
            tempDirections = r.directions ? r.directions.slice() : [];
            renderTempIngredients(); renderTempDirections();
            openModal('add-recipe');
        }
        function deleteRecipe() { if (!confirm('Delete?')) return; appData.recipes = appData.recipes.filter(function(r){return r.id!==parseInt(document.getElementById('edit-recipe-id').value);}); saveData(); renderRecipes(); closeModal('add-recipe'); }

        // Import/Export Functions
        function pasteFromClipboard() {
            navigator.clipboard.readText().then(function(text) {
                document.getElementById('import-json').value = text;
            }).catch(function() { alert('Could not access clipboard'); });
        }
        function copyTemplate() {
            var template = '{\n  "name": "Recipe Name",\n  "type": "Sourdough",\n  "days": 2,\n  "ingredients": [\n    {"amount": "500", "unit": "g", "name": "Flour"}\n  ],\n  "directions": [\n    {"day": 1, "step": "Mix ingredients"}\n  ],\n  "notes": "Optional notes"\n}';
            navigator.clipboard.writeText(template).then(function() { alert('Template copied!'); });
        }
        function importRecipes() {
            var json = document.getElementById('import-json').value.trim();
            if (!json) return alert('Please paste recipe JSON');
            try {
                var data = JSON.parse(json);
                var recipes = data.recipes ? data.recipes : (Array.isArray(data) ? data : [data]);
                var count = 0;
                recipes.forEach(function(r) {
                    if (r.name) {
                        appData.recipes.push({
                            id: Date.now() + count,
                            name: r.name,
                            type: r.type || 'Sourdough',
                            days: r.days || 2,
                            ingredients: (r.ingredients || []).map(function(i, idx) { return {id: Date.now()+idx, amount: i.amount, unit: i.unit, name: i.name}; }),
                            directions: (r.directions || []).map(function(d, idx) { return {id: Date.now()+idx+100, day: d.day, step: d.step}; }),
                            phases: r.phases || ['mixing','bulk-fermentation','shaping','proofing','baking','completed'],
                            notes: r.notes || ''
                        });
                        count++;
                    }
                });
                saveData();
                renderRecipes();
                closeModal('import-recipe');
                alert('Imported ' + count + ' recipe(s)!');
            } catch(e) { alert('Invalid JSON format: ' + e.message); }
        }
        function exportRecipeJSON(id) {
            var r = appData.recipes.find(function(x){return x.id===id;});
            if (!r) return;
            var exportData = {
                name: r.name,
                type: r.type,
                days: r.days,
                ingredients: r.ingredients.map(function(i) { return {amount: i.amount, unit: i.unit, name: i.name}; }),
                directions: r.directions.map(function(d) { return {day: d.day, step: d.step}; }),
                phases: r.phases,
                notes: r.notes
            };
            var json = JSON.stringify(exportData, null, 2);
            downloadFile(json, r.name.replace(/\s+/g, '_') + '.json', 'application/json');
        }
        function exportAllRecipes() {
            if (!appData.recipes.length) return alert('No recipes to export');
            var exportData = {
                recipes: appData.recipes.map(function(r) {
                    return {
                        name: r.name,
                        type: r.type,
                        days: r.days,
                        ingredients: r.ingredients.map(function(i) { return {amount: i.amount, unit: i.unit, name: i.name}; }),
                        directions: r.directions.map(function(d) { return {day: d.day, step: d.step}; }),
                        phases: r.phases,
                        notes: r.notes
                    };
                })
            };
            var json = JSON.stringify(exportData, null, 2);
            downloadFile(json, 'all_recipes.json', 'application/json');
        }
        function downloadFile(content, filename, type) {
            var blob = new Blob([content], {type: type});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function startSession() {
            var recipeId = parseInt(document.getElementById('session-recipe').value);
            var starterId = document.getElementById('session-starter').value ? parseInt(document.getElementById('session-starter').value) : null;
            var recipe = appData.recipes.find(function(r){return r.id===recipeId;});
            var starter = starterId ? appData.starters.find(function(s){return s.id===starterId;}) : null;
            if (!recipe) return alert('Select recipe');
            var session = { id: Date.now(), recipeId: recipeId, recipeName: recipe.name, starterId: starterId, starterName: starter ? starter.name : null, startDate: new Date().toISOString(), currentDay: 1, currentPhase: 'mixing', phaseStartTime: new Date().toISOString(), isActive: true, checkedIngredients: [], checkedSteps: [], notes: defaultNotesTemplate };
            appData.sessions.push(session);
            saveData(); renderSessions(); closeModal('start-session'); switchTab('sessions');
            openSessionDetail(session.id);
        }
        function openSessionDetail(id) {
            var s = appData.sessions.find(function(x){return x.id===id;}); if (!s) return;
            var recipe = appData.recipes.find(function(r){return r.id===s.recipeId;});
            document.getElementById('session-detail-title').textContent = s.recipeName;
            var phases = ['mixing','bulk-fermentation','shaping','proofing','baking','completed'];
            var phaseTime = getPhaseTime(s);
            var ingHtml = '<p style="color:var(--text-secondary)">No ingredients</p>';
            if (recipe && recipe.ingredients && recipe.ingredients.length) {
                ingHtml = recipe.ingredients.map(function(i){ var chk = s.checkedIngredients && s.checkedIngredients.indexOf(i.id) !== -1; return '<div class="check-item '+(chk?'checked':'')+'" onclick="toggleIngredient('+s.id+','+i.id+')"><span class="check-icon">'+(chk?'‚òë':'‚òê')+'</span><span class="check-text"><b>'+i.amount+' '+i.unit+'</b> '+i.name+'</span></div>'; }).join('');
            }
            var dirHtml = '<p style="color:var(--text-secondary)">No directions</p>';
            if (recipe && recipe.directions && recipe.directions.length) {
                dirHtml = recipe.directions.map(function(d,i){ var chk = s.checkedSteps && s.checkedSteps.indexOf(d.id) !== -1; return '<div class="check-item '+(chk?'checked':'')+'" onclick="toggleStep('+s.id+','+d.id+')"><span class="check-icon">'+(chk?'‚òë':'‚òê')+'</span><span class="check-text"><b>Day '+d.day+', Step '+(i+1)+':</b> '+d.step+'</span></div>'; }).join('');
            }
            var phaseButtons = phases.map(function(p){return '<button onclick="updatePhase('+s.id+',\''+p+'\')" style="padding:8px 12px;border-radius:20px;border:none;cursor:pointer;font-size:12px;background:'+(s.currentPhase===p?'var(--primary)':'var(--bg)')+';color:'+(s.currentPhase===p?'white':'var(--text-secondary)')+'">'+getPhaseIcon(p)+'</button>';}).join('');
            var dayButtons = [1,2,3,4,5].map(function(d){return '<button onclick="updateDay('+s.id+','+d+')" style="width:36px;height:36px;border-radius:50%;border:none;cursor:pointer;background:'+(d===s.currentDay?'var(--primary)':'var(--bg)')+';color:'+(d===s.currentDay?'white':'var(--text)')+'">'+d+'</button>';}).join('');
            document.getElementById('session-detail-body').innerHTML = (s.isActive?'<div class="timer-badge">In '+s.currentPhase+' for: <b>'+phaseTime+'</b></div>':'')+'<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px">'+phaseButtons+'</div><div class="detail-section"><h4>Day '+s.currentDay+'</h4><div style="display:flex;gap:8px;margin-top:8px">'+dayButtons+'</div></div><div class="detail-section"><h4>Ingredients <span style="font-weight:normal;font-size:12px;color:var(--text-secondary)">(tap to check)</span></h4>'+ingHtml+'</div><div class="detail-section"><h4>Directions <span style="font-weight:normal;font-size:12px;color:var(--text-secondary)">(tap to check)</span></h4>'+dirHtml+'</div><div class="detail-section"><h4>Session Notes</h4><textarea class="form-input" style="min-height:200px;font-size:14px" onchange="updateSessionNotes('+s.id+',this.value)">'+escapeHtml(s.notes||'')+'</textarea></div>'+(s.isActive?'<button class="btn-primary" style="background:var(--success)" onclick="completeSession('+s.id+')">Complete Session</button>':'')+'<button class="btn-danger" onclick="deleteSessionConfirm('+s.id+')">Delete Session</button>';
            openModal('session-detail');
        }
        function escapeHtml(str) { return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
        function updateSessionNotes(id, notes) { var s = appData.sessions.find(function(x){return x.id===id;}); if (s) { s.notes = notes; saveData(); } }
        function deleteSessionConfirm(id) { if(confirm('Delete this session?')){appData.sessions=appData.sessions.filter(function(x){return x.id!==id;});saveData();renderSessions();closeModal('session-detail');} }
        function toggleIngredient(sid, iid) { var s = appData.sessions.find(function(x){return x.id===sid;}); if (!s) return; if (!s.checkedIngredients) s.checkedIngredients = []; var idx = s.checkedIngredients.indexOf(iid); if (idx === -1) s.checkedIngredients.push(iid); else s.checkedIngredients.splice(idx,1); saveData(); openSessionDetail(sid); }
        function toggleStep(sid, did) { var s = appData.sessions.find(function(x){return x.id===sid;}); if (!s) return; if (!s.checkedSteps) s.checkedSteps = []; var idx = s.checkedSteps.indexOf(did); if (idx === -1) s.checkedSteps.push(did); else s.checkedSteps.splice(idx,1); saveData(); openSessionDetail(sid); }
        function updatePhase(id,p) { var s = appData.sessions.find(function(x){return x.id===id;}); if (s) { s.currentPhase = p; s.phaseStartTime = new Date().toISOString(); if (p === 'completed') s.isActive = false; saveData(); openSessionDetail(id); renderSessions(); } }
        function updateDay(id,d) { var s = appData.sessions.find(function(x){return x.id===id;}); if (s) { s.currentDay = d; saveData(); openSessionDetail(id); } }
        function completeSession(id) { var s = appData.sessions.find(function(x){return x.id===id;}); if (s) { s.isActive = false; s.currentPhase = 'completed'; saveData(); closeModal('session-detail'); renderSessions(); } }

        function renderCalendar() {
            var grid = document.getElementById('calendar-grid'), y = currentMonth.getFullYear(), m = currentMonth.getMonth();
            document.getElementById('calendar-month').textContent = currentMonth.toLocaleDateString('en-US',{month:'long',year:'numeric'});
            var firstDay = new Date(y,m,1), lastDay = new Date(y,m+1,0), pad = firstDay.getDay();
            var html = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(function(d){return '<div class="calendar-day-header">'+d+'</div>';}).join('');
            for (var i = 0; i < pad; i++) html += '<div class="calendar-day" style="opacity:0.3">'+(new Date(y,m,-pad+i+1).getDate())+'</div>';
            for (var day = 1; day <= lastDay.getDate(); day++) {
                var date = new Date(y,m,day), isToday = isSameDay(date,new Date()), isSel = isSameDay(date,selectedDate);
                var events = getEventsForDate(date);
                html += '<div class="calendar-day '+(isToday?'today':'')+' '+(isSel?'selected':'')+'" onclick="selectCalendarDay('+y+','+m+','+day+')">'+day+'<div class="calendar-dots">'+(events.feeding?'<div class="calendar-dot feeding"></div>':'')+(events.session?'<div class="calendar-dot session"></div>':'')+'</div></div>';
            }
            grid.innerHTML = html;
            renderCalendarEvents();
        }
        function selectCalendarDay(y,m,d) { selectedDate = new Date(y,m,d); renderCalendar(); }
        function changeMonth(delta) { currentMonth = new Date(currentMonth.getFullYear(),currentMonth.getMonth()+delta,1); renderCalendar(); }
        function renderCalendarEvents() {
            var c = document.getElementById('calendar-events'), events = getEventsForDate(selectedDate);
            var html = '<h4 style="font-family:Fraunces,serif;margin-bottom:12px">'+selectedDate.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'})+'</h4>';
            if (!events.feedingStarters.length && !events.sessions.length) html += '<p style="color:var(--text-secondary)">No events on this day</p>';
            else {
                events.feedingStarters.forEach(function(s){ html += '<div class="event-card" onclick="openStarterDetail('+s.id+')" style="background:rgba(212,169,74,0.1)"><span style="font-size:20px">ü´ô</span><div style="flex:1"><b>'+s.name+'</b><br><span style="font-size:13px;color:var(--text-secondary)">Feed starter</span></div><span style="color:var(--text-secondary)">‚Ä∫</span></div>'; });
                events.sessions.forEach(function(s){ html += '<div class="event-card" onclick="openSessionDetail('+s.id+')" style="background:rgba(212,133,74,0.1)"><span style="font-size:20px">'+getPhaseIcon(s.currentPhase)+'</span><div style="flex:1"><b>'+s.recipeName+'</b><br><span style="font-size:13px;color:var(--text-secondary)">'+(s.isActive?'Day '+s.currentDay+' - '+s.currentPhase:'Completed')+'</span></div><span style="color:var(--text-secondary)">‚Ä∫</span></div>'; });
            }
            c.innerHTML = html;
        }
        function openStarterDetail(id) {
            var s = appData.starters.find(function(x){return x.id===id;}); if (!s) return;
            document.getElementById('starter-detail-title').textContent = s.name;
            var days = s.lastFed ? Math.floor((Date.now() - new Date(s.lastFed+'T00:00:00').getTime()) / 86400000) : null;
            var fedStr = s.lastFed ? new Date(s.lastFed+'T00:00:00').toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}) : 'Never';
            var locName = s.location.charAt(0).toUpperCase() + s.location.slice(1);
            document.getElementById('starter-detail-body').innerHTML = '<div style="text-align:center;padding:20px"><span style="font-size:48px">ü´ô</span><h2 style="margin-top:12px">'+s.name+'</h2><p style="color:var(--text-secondary)">'+locName+'</p></div><div class="detail-section"><h4>Status</h4><p style="color:var(--text)"><b>Last Fed:</b> '+fedStr+'</p>'+(days!==null?'<p style="color:var(--text)"><b>Days Since:</b> '+days+' days</p>':'')+'</div>'+(s.notes?'<div class="detail-section"><h4>Notes</h4><p style="color:var(--text)">'+s.notes+'</p></div>':'')+(s.location!=='dried'?'<button class="btn-primary" style="background:var(--success)" onclick="feedStarter('+s.id+');closeModal(\'starter-detail\');renderCalendar()">Mark as Fed</button>':'')+'<button class="btn-primary" onclick="closeModal(\'starter-detail\');editStarter('+s.id+')">Edit Starter</button>';
            openModal('starter-detail');
        }
        function getEventsForDate(date) {
            var feedingStarters = appData.starters.filter(function(s) { if (s.location === 'dried' || !s.lastFed) return false; var next = new Date(s.lastFed+'T00:00:00'); next.setDate(next.getDate() + (s.location === 'refrigerator' ? 7 : 1)); return isSameDay(next,date); });
            var sessions = appData.sessions.filter(function(s) { return isSameDay(new Date(s.startDate),date); });
            return { feeding: feedingStarters.length > 0, session: sessions.length > 0, feedingStarters: feedingStarters, sessions: sessions };
        }
        function isSameDay(a,b) { return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }

        loadData(); renderStarters(); renderRecipes(); renderSessions();
    </script>
</body>
</html>
